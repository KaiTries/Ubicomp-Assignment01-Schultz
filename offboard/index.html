<html>
 <head>
 </head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="model.js"></script>
<body>
<canvas id="myChart" style="width:100%;max-width:700px"></canvas>
  <script src="https://www.espruino.com/js/uart.js"></script>
  <script>

  var receivedData = [];
  var gettingData;
  
	function extractDataFromResponse(response){
		if(response != null){
			//TODO: Extract data from received CSV string
      console.log(response);
		}
	}

	function doClassification(data){
		//TODO: Call the classify function from model.js
	}

	var chart = null;
	function makeChart(data) {

		//TODO: Plot the accelerometer data 
		//HINT: You can use Chart.js API (This task is optional)

	}


  function receiveData() {
    if (UART.isConnected()) {
  gettingData = window.setInterval(function(){
    getData();
  }, 1000);
    }
}

	function getData() {
		UART.eval('dumpData()', function(response) {
			document.getElementById("sensordata").value = response;
			var data = extractDataFromResponse(response);
			makeChart(data);
			doClassification(data);
    });
}

  function disconnect() {
    if(UART.isConnected) {
    clearInterval(gettingData);
    UART.close();
    }
  }
	
	//This helper function copies the accelerometer data to the clipboard for testing
	function copy() {
		var copyText = document.getElementById("sensordata");
		copyText.select();
		copyText.setSelectionRange(0, 99999); /* For mobile devices */
		navigator.clipboard.writeText(copyText.value);
		alert("Copied the text: " + copyText.value);
	}
  
</script>
  
  <div>
  <button style="margin: 20px;" onclick="getData()">Retrieve and process</button>
  <button style="margin: 20px;" onclick="receiveData()">receive</button>
  <button style="margin: 20px;" onclick="disconnect()"> Disconnect Device</button>
  <input style="margin: 20px; width: 500px" type="text" value=".." id="sensordata">
  <button onclick="copy()">Copy</button>
  </div>
  <div>
    <label style="margin: 20px; width: 500px" id="result">Classifer output:...</label>
	</div>
 </body>
</html>
